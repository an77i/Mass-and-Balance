<!DOCTYPE HTML>
<html>
<!--
    Mass and balance calculator for nothing

    https://github.com/kaltsi/Mass-and-Balance

    Copyright (c) 2012 Juha Kallioinen <kaltsi+github@gmail.com>

    Permission is hereby granted, free of charge, to any person obtaining a copy
    of this software and associated documentation files (the "Software"), to deal
    in the Software without restriction, including without limitation the rights
    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the Software is
    furnished to do so, subject to the following conditions:

    The above copyright notice and this permission notice shall be included in
    all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
    THE SOFTWARE.

-->

<head>

<style type="text/css">
<!--
table.a
{
    border-radius: 6%;
    padding: 10px 10px 10px 10px;
    box-shadow: 3px 3px 5px gray;
}

table.a th
{
    border: 0px;
    padding: 1px;
    text-align: right;
}

table.a td
{
    text-align: right;
    padding: 3px;
}

table.b
{
    border-radius: 6%;
    padding: 10px 10px 10px 10px;
    box-shadow: 3px 3px 5px gray;
}

table.b td
{
    border: 0px;
    padding: 1px;
}

.alignleft
{
    float: left;
}
.alignright
{
    float: right;
}

//-->
</style>

<script type="text/javascript">

<!--

    /*  Some conversion constants */

    var g_kg_lbs              = 2.20462262; // 1 kg  -> lb
    var g_ltr_usg             = 0.26417205; // 1 ltr -> USG
    var g_m_inch              = 39.3700787; // 1 m   -> inches
    var g_usg_fuel_lb         = 6.0;  // 1 usg = 6 lbs
    var g_ltr_fuel_kg         = 0.72; // 1 ltr = 0.72 kg
    var g_mass_unit           = "kg"; // default in kilos

    /* basic numeric value object with unit and type */

    function value_unit(v, u)
    {
	switch (u) {
	case "kg":
	case "lb":
	case "ltr":
	case "usg":
	case "min":
	case "qrt":
	    break;
	default:
	    // this should not happen
	    alert("value_unit with values: " + v + " " + u + " called.");
	}

	this.num  = v;
	this.unit = u;
    }

    value_unit.prototype.mins_to_hrs = function m2hrs(mins)
    {
	var m, h;

	function pad2(num) {
	    return (num < 10?'0':'') + num;
	}
	
	h = mins / 60.0;
	m = mins % 60.0;
	
	return pad2(Math.floor(h)) + ":" + pad2(Math.floor(m));
    }


    value_unit.prototype.add = function v_add(n)
    {
	this.num += n.num;
    }

    /* 
       display the value and unit
       n: num of decimals              */
       
    value_unit.prototype.display = function v_display(n)
    {
	if (n) {
	    return this.num.toFixed(n) + " " + this.unit;
	}
	else {
	    return this.num + " " + this.unit;
	}
    }

    /* 
       get the mass of the fuel volume
       n: num of decimals
       u: also show unit
    */

    value_unit.prototype.dispmass = function v_mass(n, u)
    {
	var m = this.num;
	
	switch (this.unit) {
	case "ltr":
	    if (g_mass_unit == "kg")
		m = m * g_ltr_fuel_kg;
	    else
		m = m * g_ltr_fuel_kg * g_kg_lbs;
	    break;
	case "usg":
	    if (g_mass_unit == "kg")
		m = m * g_usg_fuel_lb / g_kg_lbs;
	    else
		m = m * g_usg_fuel_lb;
	    break;
	case "qrt":
	    // TODO XXX implement this
	    break;
	default:
	    // fall through, display the raw value
	}
	
	if (n) {
	    return m.toFixed(n) + (u?" " + g_mass_unit:"");
	}
	else {
	    return m + (u?" " + g_mass_unit:"");
	}
    }
    
    /* switch the unit and recalculate the value */
    
    value_unit.prototype.unitchg = function v_unit_change()
    {
	var that = this; // inner function trick
	var update_min_max = function(m) {
 	    if (that.lp) {
		that.lp.min = that.lp.min * m;
		that.lp.max = that.lp.max * m;
	    }
	}

	switch (this.unit) {
	case "kg":
	    this.unit  = "lb";
	    this.num = this.num * g_kg_lbs;
	    update_min_max(g_kg_lbs);
	    break;
	case "lb":
	    this.unit = "kg";
	    this.num = this.num / g_kg_lbs;
	    update_min_max(1/g_kg_lbs);
	    break;
	case "ltr":
	    this.unit = "usg";
	    this.num = this.num * g_ltr_usg;
	    update_min_max(g_ltr_usg);
	    break;
	case "usg":
	    this.unit = "ltr";
	    this.num = this.num / g_ltr_usg;
	    update_min_max(1/g_ltr_usg);
	    break;
	case "qrt":
	    // TODO XXX implement this
	    break;
	default:
	    alert("Invalid v_unit_change: cannot happen!");
	}
    }

    /*
       l_point - a load point object

       id:     name of the global variable this is assigned to
       descr:  basic text for the row
       dflt:   mass of the load point (default value when constructed)
       unit:   kg or ltr
       min:    minimum value
       max:    max value (negative means do-not-print)
       arm:    moment arm
    */

    function l_point(id, descr, unit, dflt, min, max, arm, step)
    {
	this.id      = id;
	this.descr   = descr;
	this.mass    = new value_unit(dflt, unit);
	this.min     = min;
	this.max     = Math.abs(max);
	this.dispmax = (max > 0 ?1:0);
	this.arm     = arm;
	this.step    = step;

	this.mass.lp = this; // associate the mass object with this
    }

    /* lp:    load point object  */

    function interactive_row(lp)
    {
	this.lp    = lp;
	this.id    = this.lp.id;
	this.cell1 = this.lp.id + "c1";
	this.cellr = this.lp.id + "c2";
	this.sldr  = this.lp.id + "s";
    }
    
    interactive_row.prototype.description = function i_descr()
    {
	var a = '<th>' + this.lp.descr;

	if (this.lp.dispmax) 
	    a += ' (max ' + this.lp.max.toFixed() + ' ' + this.lp.mass.unit +')';

	a += '</th>';
	return a;
    }

    interactive_row.prototype.result = function i_result()
    {
	return '<td id="' + this.cellr + '">' + this.lp.mass.dispmass(1) + '</td>';
    }
    
    interactive_row.prototype.content = function i_content()
    {
	var a = this.description();

	a += '<td bgcolor="yellow" id="' + this.cell1 + '">' + this.lp.mass.display(1) + '</td>';
	
	a += '<th> <input id="' + this.sldr + '" type="range" min="' + this.lp.min + '" ';
	a += 'max="' + this.lp.max + '" value="' + this.lp.mass.num +'" ';
	if (this.lp.step)
	    a += 'step="' + this.lp.step +'" ';
	a += 'onchange="update_x(this,\'' + this.lp.id + '\', \'' + this.cell1 + '\', \'' + this.cellr + '\')"/></th>';
	a += this.result();
	
	return a;
    }

    interactive_row.prototype.unitchg = function i_update()
    {
	var x = document.getElementById(this.sldr);

	this.lp.mass.unitchg();
	x.min = this.lp.min;
	x.max = this.lp.max;
	x.value = this.lp.mass.num;

	var r = document.getElementById(this.id);
	r.innerHTML = this.content();
    }

    /* lp: the load point for this row */

    function non_interactive_row(lp)
    {
	this.lp    = lp;
	this.id    = this.lp.id;
	this.cellr = this.lp.id+"c1";
    }

    non_interactive_row.prototype.description = function ni_descr()
    {
	var a = '<th>'+ this.lp.descr;
	if (this.lp.dispmax)
	    a += " (max "+ this.lp.max.toFixed() + " " + this.lp.mass.unit + ")";
	a += '</th>';
	return a;
    }

    non_interactive_row.prototype.result = function ni_result()
    {
	return '<td id="' + this.cellr + '">' + this.lp.mass.dispmass(1) + '</td>';
    }
    
    non_interactive_row.prototype.content = function ni_content()
    {
	var a = this.description();

	a += '<th style="font-weight:normal; text-align:center;">. . .</th>';
	a += '<th style="font-weight:normal; text-align:center;">. . . . .</th>';
	a += this.result();
	return a;
    }

    non_interactive_row.prototype.unitchg = function ni_update()
    {
	this.lp.mass.unitchg();
	var r = document.getElementById(this.id);
	r.innerHTML = this.content();
    }
    

    function setup()
    {
	var i;

	/* TODO implement this stuff
	if (typeof(Storage) !== "undefined") {
	    var t = setTimeout("load_reminder()", 1000);
	}
        */

	g_bw   = new l_point("g_bw",   "Basic weight",  "kg",  737,  0,  0,     1.23);
	g_fs   = new l_point("g_fs",   "Front seat",    "kg",  85,   25, -200,  1.23);
	g_bs   = new l_point("g_bs",   "Back seat",     "kg",  0,    0,  -200,  1.33);
	g_fuel = new l_point("g_fuel", "Fuel",          "ltr", 100,  0,  143,   1.25, 0.1);
	g_bagg = new l_point("g_bagg", "Baggage",       "kg",  10,   0,  54,    1.44);
	g_taxi = new l_point("g_taxi", "Taxi fuel",     "ltr", 2,    0,  -10,   1.25, 0.1);
	g_tow  = new l_point("g_tow",  "Take-off mass", "kg",  1100, 0,  1100,  1);
	g_lw   = new l_point("g_lw",   "Landing mass",  "kg",  1000, 0,  1000,  1);

	row1 = new non_interactive_row(g_bw);
	row2 = new interactive_row(g_fs);
	row3 = new interactive_row(g_bs);
	row4 = new interactive_row(g_fuel);
	row5 = new interactive_row(g_bagg);
	row6 = new interactive_row(g_taxi);
	row7 = new non_interactive_row(g_tow);
	row8 = new non_interactive_row(g_lw);

	load_points = [g_bw, g_fs, g_bs, g_fuel, g_bagg, g_taxi, g_tow, g_lw]
	rows = [row1, row2, row3, row4, row5, row6, row7, row8]
	
	for (i = 0; i < rows.length; i++) {
	    var row = document.getElementById("table1").insertRow(-1);
	    row.id = rows[i].id;
	    row.innerHTML = rows[i].content();
	}

	/*
	lp9 = new l_point("lp9", "Fuel flow",     "ltr", 5,    3,  -20,   1, 0.1);
	lp10 = new l_point("lp10", "Flight time", "ltr", 60,   1,  300,   1);
	row9 = new interactive_row(lp9);
	row10 = new interactive_row(lp10);
        */

    }

    function load_reminder()
    {
	var x = document.getElementById("reminder");
	x.innerText="Loaded your default settings.";
	var t = setTimeout("remove_reminder()", 5000);
    }

    function remove_reminder()
    {
	var x = document.getElementById("reminder");
	x.innerText="";
    }

    /* change all numbers and their units */

    function handle_unit_change(t)
    {
	var i = 0;

	switch (t.value) {
	case "kg & litre":
	    g_mass_unit = "kg";
	    break;
	case "lbs & usg":
	    g_mass_unit = "lb";
	    break;
	default:
	    alert("this.selectedIndex");
	}

 	mass_title.innerText = "Mass (" + g_mass_unit + ")";

	for (i = 0; i < rows.length; i++) {
	    rows[i].unitchg();
	}
    }

    /*
       update the value displays in the table

       ctrl:  input range element reference
       lp:    global load point variable
       cell1: id of the 1st output cell
       cell2: id of the 2nd output cell
    */

    function update_x(ctrl, lp, cell1, cell2)
    {
	var c1 = document.getElementById(cell1);
	var c2 = document.getElementById(cell2);

	eval(lp).mass.num = ctrl.valueAsNumber;
	c1.innerText = eval(lp).mass.display(1);
	c2.innerText = eval(lp).mass.dispmass(1);

	calculate();
    }

    function update_cells()
    {
	for (i = 0; i < rows.length; i++) {
	    var row = document.getElementById(rows[i].id);
	    var c = document.getElementById(rows[i].cellr)
	    c.innerHTML = rows[i].result();
	}
    }

    function update_rows()
    {
	for (i = 0; i < rows.length; i++) {
	    var row = document.getElementById(rows[i].id);
	    row.innerHTML = rows[i].content();
	}
    }

    /* take in an arbitrary number of value_unit objects and calculate their mass */

    function calc_mass()
    {
	var i, mass = 0;

	for (i = 0; i < arguments.length; i++) {
	    mass += arguments[i].mass.num;
	}

	return mass;
    }

    function calculate()
    {
	g_tow.mass.num = calc_mass(g_bw, g_fs, g_bs, g_fuel, g_bagg);
	g_tow.mass.num -= g_taxi.mass.num;

	update_cells();
    }

    window.onload = setup;
//-->
</script>

<title>OH-FOO m&amp;b</title>

</head>
<body>
  
  <h1>Blah OH-FOO</h1>
  
  <button type="button" onclick="calculate()">Calculate</button>
  <button type="button" onclick="save_settings()">Save settings</button> <!-- localStorage.clear() -->
  <button type="button" onclick="clear_settings()">Clear settings</button>
  
  <p/>
  
  <table border="1" class="a" id="table1">
    <tbody>
      <tr>
    <th width="225px" id="reminder" style="color:red;" ></th>
	<th width="75px" style="text-align:center;">Input</th>
	<th style="text-align:center;">
	  <select id="units" onchange="handle_unit_change(this)">
	    <option selected="selected">kg & litre</option>
	    <option>lbs & usg</option>
	  </select>
	</th>
	<th width="75px" style="text-align:center;" id="mass_title">Mass</th>
      </tr>
    </tbody>
  </table>
<p/>
  <table border="1" class="a" id="table2">
    <tbody>
      <tr>
	<th width="225px">Landing mass (max 1000 kg) </th>
	<th width="75px" style="font-weight:normal;text-align:center;">. . .</th>
	<th style="font-weight:normal;text-align:center;">. . . . .</th>
	<td width="75px" style="text-align:right;">768.0</td>
      </tr>
      <tr>
	<th width="225px">Endurance</th>
	<th width="75px" style="text-align:center;font-weight:normal;">. . .</th>
	<th style="font-weight:normal;text-align:center;">. . . . .</th>
	<td width="75px" style="text-align:right;">03:45 h</td>
      </tr>
      <tr>
	<th width="225px">Fuel flow</th>
	<td width="75px" bgcolor="yellow" style="text-align:Right;">22.0 ltr/h</td>
	<th><input type="range"</th>
	<td/><!-- width="75px" style="text-align:right;">10.0 ltr/h</td-->
      </tr>
    </tbody>
  </table>

</body>
</html>



