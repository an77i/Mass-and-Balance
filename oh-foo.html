<!DOCTYPE HTML>
<html>
<!--
    Mass and balance calculator for OH-FOO.

    https://github.com/kaltsi/Mass-and-Balance

    Adapted from OH-FOO Weight and Balance Excel sheet by Miika Asunta (29.07.2010)

    Copyright (c) 2012 Juha Kallioinen <kaltsi+github@gmail.com>

    Permission is hereby granted, free of charge, to any person obtaining a copy
    of this software and associated documentation files (the "Software"), to deal
    in the Software without restriction, including without limitation the rights
    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the Software is
    furnished to do so, subject to the following conditions:

    The above copyright notice and this permission notice shall be included in
    all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
    THE SOFTWARE.

-->

<head>

<style type="text/css">
<!--
table.a
{
    border-radius: 6%;
    padding: 10px 10px 10px 10px;
    box-shadow: 3px 3px 5px gray;
}

table.a th
{
    border: 0px;
    padding: 1px;
    text-align: right;
}

table.b
{
    border-radius: 6%;
    padding: 10px 10px 10px 10px;
    box-shadow: 3px 3px 5px gray;
}

table.b td
{
    border: 0px;
    padding: 1px;
}

.alignleft
{
    float: left;
}
.alignright
{
    float: right;
}

//-->
</style>

<script type="text/javascript">

<!--

    // Some conversion constants
    var g_kg_lbs              = 2.20462262; // 1 kg  -> lb
    var g_ltr_usg             = 0.26417205; // 1 ltr -> USG
    var g_m_inch              = 39.3700787; // 1 m   -> inches
    var g_usg_fuel_lb         = 6.0;  // 1 usg = 6 lbs
    var g_ltr_fuel_kg         = 0.72; // 1 ltr = 0.72 kg
    var g_mass_unit           = "kg"; // default in kilos

    var x, y;
    var row1, row2, row3, row4, row5, row6, row7, row8;

    var lp1, lp2, lp3, lp4, lp5, lp6, lp7, lp8;

    // basic numeric value with unit and type
    function value_unit(v, u)
    {
	switch (u) {
	case "kg":
	case "lb":
	case "ltr":
	case "usg":
	    break;
	default:
	    // this should not happen
	    alert("value_unit with values: " + v + " " + u + " called.");
	}

	this.value = v;
	this.unit  = u;

	// this.display  = v_display;
	// this.dispmass = v_display_mass;
	// this.unitchg  = v_unit_change;
    }


    // display the value and unit
    // n: num of decimals

    value_unit.prototype.display = function v_display(n)
    {
	if (n) {
	    return this.value.toFixed(n) + " " + this.unit;
	}
	else {
	    return this.value + " " + this.unit;
	}
    }

    // display the mass of the fuel volume
    // n: num of decimals
    // u: also show unit
    value_unit.prototype.dispmass = function v_display_mass(n, u)
    {
	var m = this.value;
	
	switch (this.unit) {
	case "ltr":
	    if (g_mass_unit == "kg")
		m = m * g_ltr_fuel_kg;
	    else
		m = m * g_ltr_fuel_kg * g_kg_lbs;
	    break;
	case "usg":
	    if (g_mass_unit == "kg")
		m = m * g_usg_fuel_lb / g_kg_lbs;
	    else
		m = m * g_usg_fuel_lb;
	    break;
	default:
	    // fall through, display the raw value
	}
	
	if (n) {
	    return m.toFixed(n) + (u?" " + g_mass_unit:"");
	}
	else {
	    return m + (u?" " + g_mass_unit:"");
	}
    }

    // switch the unit and recalculate value
    value_unit.prototype.unitchg = function v_unit_change()
    {
	switch (this.unit) {
	case "kg":
	    this.unit  = "lb";
	    this.value = this.value * g_kg_lbs;
	    break;
	case "lb":
	    this.unit = "kg";
	    this.value = this.value / g_kg_lbs;
	    break;
	case "ltr":
	    this.unit = "usg";
	    this.value = this.value * g_ltr_usg;
	    break;
	case "usg":
	    this.unit = "ltr";
	    this.value = this.value / g_ltr_usg;
	    break;
	default:
	    alert("Invalid v_unit_change: cannot happen!");
	}
    }


    function setup()
    {
	row1 = new non_interactive_row("Basic weight", 737, 1.234, 1, 1234, "bw");
	lp2  = new l_point("lp2", "Front seat", 85, "kg", 25, 200, 1.23, 1);
	lp3  = new l_point("lp3", "Back seat", 0, "kg", 0, 200, 1,33, 1);
	lp4  = new l_point("lp4", "Fuel", 100, "ltr", 0, 143, 1,25, 1);
	lp5  = new l_point("lp5", "Baggage", 10, "kg", 0, 54, 1,44, 1);
	lp6  = new l_point("lp6", "Taxi fuel", 2, "kg", 0, 20, 1,25, 1);

	row2 = new interactive_row(lp2, "a1", "a2", "s1");
	row3 = new interactive_row(lp3, "b1", "b2", "s2");
	row4 = new interactive_row(lp4, "c1", "c2", "s3");
	row5 = new interactive_row(lp5, "d1", "d2", "s4");
	row6 = new interactive_row(lp6, "e1", "e2", "s5");

	row7 = new non_interactive_row("Take-off mass", 1100, 1.234, 1, 1234, "tkof");
	row8 = new non_interactive_row("Landing mass", 1000, 1.234, 1, 1234, "land");

	document.getElementById("mytable").insertRow(-1).innerHTML = row1.content();
	document.getElementById("mytable").insertRow(-1).innerHTML = row2.content();
	document.getElementById("mytable").insertRow(-1).innerHTML = row3.content();
	document.getElementById("mytable").insertRow(-1).innerHTML = row4.content();
	document.getElementById("mytable").insertRow(-1).innerHTML = row5.content();
	document.getElementById("mytable").insertRow(-1).innerHTML = row6.content();
	document.getElementById("mytable").insertRow(-1).innerHTML = row7.content();
	document.getElementById("mytable").insertRow(-1).innerHTML = row8.content();
    }


    // id:     name of the global variable this is assigned to
    // descr:  basic text for the row
    // dflt:   mass of the load point (default value when constructed)
    // unit:   kg or ltr
    // min:    minimum value
    // max:    max value
    // arm:    moment arm
    // arm_x: set to -1 if moment arm is negative
    function l_point(id, descr, dflt, unit, min, max, arm, arm_x)
    {
	this.descr  = descr;
	this.mass   = new value_unit(dflt, unit);
	this.min    = min;
	this.max    = max;
	this.arm    = arm;
	this.armx   = arm_x; // positive or negative moment arm
	this.moment = this.mass.value * this.arm * this.armx;
	this.id     = id;
    }

    // val1:  cell id of the input value
    // val2:  cell id of the output mass value
    // sldr:  input range element id
    function interactive_row(lp, val1, val2, sldr)
    {
	this.lp    = lp;
	this.val1  = val1;
	this.val2  = val2;
	this.sldr  = sldr;
    }
    
    interactive_row.prototype.content = function i_content()
    {
	var a = '<th>' + this.lp.descr + (this.lp.max?' (max ' + this.lp.max + ' ' + g_mass_unit +')':'') + '</th>';
	var b = '<th> <input id="' + this.sldr + '" ';
	var c = 'type="range" ';
	var d = 'min="' + this.lp.min + '" ';
	var e = 'max="' + this.lp.max + '" ';
	var f = 'value="' + this.lp.mass.value +'" ';
	var g = 'onchange="update_x(this,\'' + this.lp.id + '\', \'' + this.val1 + '\', \'' + this.val2 + '\')"/></th>';
	var h = '<td id="' + this.val1 + '">' + this.lp.mass.display(1) + '</td>';
	var i = '<td id="' + this.val2 + '">' + this.lp.mass.dispmass(1) +'</td>';
	
	return a + b + c + d + e + f + g + h + i;
    }

    
    function button_clicked()
    {
	var z = document.getElementById("t1");
	z.innerHTML=x.display(1) + " " + y.display(1);
    }
    
    function button_clicked2()
    {
	var z = document.getElementById("t1");
	x.unitchg();
	y.unitchg();
	z.innerHTML=x.display(1) + " " + y.display(1);
    }

    
    function update_range(sldr)
    {
	var s = document.getElementById(sldr);
    }
    
    function button_clicked3()
    {
	var z = document.getElementById("sld1");
	x.unitchg();
	if (x.unit == "kg") {
	    sld1.min="25";
	    sld1.max="200";
	    sld1.value = x.value;
	}
	else {
	    sld1.min="50";
	    sld1.max="400";
	    sld1.value = x.value;
	}
	
	sld1.onchange();
    }
    
    function update_x(ctrl, v, what, whatelse)
    {
	var z = document.getElementById(what);
	var zz = document.getElementById(whatelse);

	eval(v).mass.value = ctrl.valueAsNumber;
	z.innerText = eval(v).mass.display(1);
	zz.innerText = eval(v).mass.dispmass(1);

    }

    function handle_unit_change(t)
    {
	switch (t.value) {
	case "kg & litre":
	    g_mass_unit = "kg";
	    break;
	case "lbs & usg":
	    g_mass_unit = "lb";
	    break;
	default:
	    alert("this.selectedIndex");
	}

	mass_title.innerText = "Mass (" + g_mass_unit + ")";
	unittoggle.onclick();
    }

    // name: basic text for the row
    // max:  if the text needs a max value
    // myid: id of the cell where the value is printed

    function non_interactive_row(name, max, myid)
    {
	this.name  = name;
	this.max   = max;
	this.myid  = myid;
	this.mom   = 0.0;
	this.mass  = new value_unit(0.0, "kg");
    }

    non_interactive_row.prototype.content = function ni_content()
    {
	return '<th>'+ this.name + (this.max?" (max "+ this.max + " " + g_mass_unit + ")":"") +
	    '</th><th> </th><th></th><td id="' + this.myid + '">' + this.mass.display(1) +'</td>';
    }


    window.onload = setup;
//-->
</script>

<title>OH-FOO m&amp;b</title>

</head>
<body>
  
  <h1>Blah OH-FOO</h1>
  
  <button type="button" onclick="button_clicked()">Save settings</button>
  <button type="button" onclick="button_clicked2()">Clear settings</button> <!-- localStorage.clear() -->
  <button type="button" id="unittoggle" title="jeah" onclick="button_clicked3()">Reset settings</button> 
  
  <p>
    <select id="units" onchange="handle_unit_change(this)">
      <option selected="selected">kg & litre</option>
      <option>lbs & usg</option>
    </select>
  </p>
  
  <p id="t1">
  </p>
  
  <p>
    <input type="text" onchange="check_text()">
  </p>
  
  <p/>
  
  <table border="1" class="a" width="600" id="mytable">
    <tbody>
      <tr>
	<th> </th>
	<th> </th>
	<th style="text-align:center;">Input</th>
	<th style="text-align:center;" id="mass_title">Mass</th>
      </tr>
      <!--tr>
	<th>  Basic weight  </th>
	<th>  </th>
	<td> 760</td>
	<td> 760</td>
      </tr>
      <tr>
	<th>  Front seat  </th>
	<th>  <input id="sld1" type="range" min="25" max="200" value="85" onchange="update_x(this, x, 'fs', 'fs2')"/>   </th>
	<td id="fs">  562.0 </td>
	<td id="fs2">  562.0 </td>
      </tr>
      
      <tr>
	<th>  Back seat  </th>
	<th>  <input type="range"/>  </th>
	<td>  0.0 </td>
	<td>  0.0 </td>
      </tr>
      <tr>
	<th>  Fuel (max 123 ung)  </th>
	<th>  <input id="sld2" type="range" min="0" max="200" value="85" onchange="update_x(this, y, 'fu', 'fu2')"/>   </th>
	<td id="fu">  0.0 </td>
	<td id="fu2">  0.0 </td>
      </tr>
      
      <tr>
	<th>  Baggage (max 12 ung)  </th>
	<th>  <input type="range"/>  </th>
	<td>  0.0 </td>
	<td>  0.0 </td>
      </tr>
      
      <tr>
	<th>  Taxi fuel (xyz)  </th>
	<th>  <input type="range"/>  </th>
	<td>  0.0 </td>
	<td>  0.0 </td>
      </tr>
      
      <tr>
	<th>  Landing mass (max 1223 ung)  </th>
	<th>   </th>
	<td>  0.0 </td>
	<td>  0.0 </td>
      </tr-->
      
    </tbody>
  </table>

</body>
</html>



